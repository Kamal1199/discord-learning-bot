const { Client, GatewayIntentBits, SlashCommandBuilder, REST, Routes, PermissionFlagsBits } = require('discord.js');
const express = require('express');

// Ú¯Ø±ÙØªÙ† ØªÙˆÚ©Ù† Ùˆ Client ID Ø§Ø² Secrets
const TOKEN = process.env.TOKEN;
const CLIENT_ID = process.env.CLIENT_ID;
const GUILD_ID = process.env.GUILD_ID; // Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø±ÙˆÛŒ ÛŒÚ© Ø³Ø±ÙˆØ± Ø®Ø§Øµ

// ÙˆØ¨â€ŒØ³Ø±ÙˆØ± Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ú¯Ù‡ Ø¯Ø§Ø´ØªÙ† Ø±Ø¨Ø§Øª Ø¢Ù†Ù„Ø§ÛŒÙ†
const app = express();
app.get("/", (req, res) => res.send("ğŸ¤– Discord Bot is running..."));
app.listen(3000, () => console.log("ğŸŒ Web server running on port 3000"));

// Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù„Ø§ÛŒÙ†Øª Discord
const client = new Client({ intents: [GatewayIntentBits.Guilds] });

// ØªØ¹Ø±ÛŒÙ Ø¯Ø³ØªÙˆØ±Ø§Øª /kml Ùˆ /viros
const commands = [
  new SlashCommandBuilder()
    .setName('kml')
    .setDescription('Û³Û±Û³ ØªØ§ Ú†Ù†Ù„ Ø¹Ø¯Ø¯ÛŒ Ø¨Ø³Ø§Ø² (Ù‡Ø± Û² Ø«Ø§Ù†ÛŒÙ‡ ÛŒÚ©ÛŒ)'),
  new SlashCommandBuilder()
    .setName('viros')
    .setDescription('âš ï¸ Ù‡Ù…Ù‡â€ŒÛŒ Ú†Ù†Ù„â€ŒÙ‡Ø§ÛŒ Ø³Ø±ÙˆØ± Ø±Ùˆ Ù¾Ø§Ú© Ú©Ù† (ÙÙ‚Ø· Ø§Ø¯Ù…ÛŒÙ†)')
    .setDefaultMemberPermissions(PermissionFlagsBits.Administrator)
].map(cmd => cmd.toJSON());

// Ø«Ø¨Øª Ø¯Ø³ØªÙˆØ±Ø§Øª
const rest = new REST({ version: '10' }).setToken(TOKEN);

(async () => {
  try {
    if (GUILD_ID) {
      console.log('ğŸ”„ Ø«Ø¨Øª Ø¯Ø³ØªÙˆØ±Ø§Øª Ø±ÙˆÛŒ Guild (ØªØ³Øª) ...');
      await rest.put(Routes.applicationGuildCommands(CLIENT_ID, GUILD_ID), { body: commands });
    } else {
      console.log('ğŸ”„ Ø«Ø¨Øª Ø¯Ø³ØªÙˆØ±Ø§Øª Global ...');
      await rest.put(Routes.applicationCommands(CLIENT_ID), { body: commands });
    }
    console.log('âœ… Ø¯Ø³ØªÙˆØ±Ø§Øª Ø«Ø¨Øª Ø´Ø¯Ù†Ø¯!');
  } catch (err) {
    console.error(err);
  }
})();

// Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯Ù† Ø±Ø¨Ø§Øª
client.once('ready', () => console.log(`ğŸ¤– ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù… Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† ${client.user.tag}`));

// Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÙˆØ±Ø§Øª
client.on('interactionCreate', async interaction => {
  if (!interaction.isChatInputCommand()) return;

  if (interaction.commandName === 'kml') {
    await interaction.reply('ğŸš€ Ø´Ø±ÙˆØ¹ Ø´Ø¯! Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª 313 Ú†Ù†Ù„ (Ù‡Ø± Û² Ø«Ø§Ù†ÛŒÙ‡ ÛŒÚ©ÛŒ)...');
    let i = 1;
    const interval = setInterval(async () => {
      if (i > 313) {
        clearInterval(interval);
        interaction.followUp('âœ… Ù‡Ù…Ù‡â€ŒÛŒ 313 Ú†Ù†Ù„ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù†Ø¯!');
        return;
      }
      try { await interaction.guild.channels.create({ name: `${i}`, type: 0 }); } 
      catch (err) { console.error(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø³Ø§Ø®Øª Ú†Ù†Ù„ ${i}:`, err); }
      i++;
    }, 2000);
  }

  if (interaction.commandName === 'viros') {
    await interaction.reply('âš ï¸ Ø¹Ù…Ù„ÛŒØ§Øª Ø­Ø°Ù Ù‡Ù…Ù‡â€ŒÛŒ Ú†Ù†Ù„â€ŒÙ‡Ø§ Ø´Ø±ÙˆØ¹ Ø´Ø¯...');
    try {
      const channels = interaction.guild.channels.cache;
      for (const [id, channel] of channels) {
        try { await channel.delete(); console.log(`ğŸ—‘ï¸ Ø­Ø°Ù Ø´Ø¯: ${channel.name}`); } 
        catch (err) { console.error(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù ${channel.name}:`, err); }
      }
      await interaction.followUp('âœ… Ù‡Ù…Ù‡â€ŒÛŒ Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯!');
    } catch (err) {
      console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§:', err);
      await interaction.followUp('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§!');
    }
  }
});

// Ù„Ø§Ú¯ÛŒÙ† Ø¨Ø§ ØªÙˆÚ©Ù† Ø§Ø² Secrets
client.login(TOKEN);
